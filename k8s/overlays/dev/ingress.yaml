apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: invisible-ingress
  namespace: invisible
  annotations:
    # Traefik will handle this automatically
    kubernetes.io/ingress.class: traefik
spec:
  rules:
  # Supabase Studio & API
  - host: api.invisible.local
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: supabase-kong
            port:
              number: 8000
  
  # UI Hub
  - host: hub.invisible.local
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: ui-hub
            port:
              number: 80
  
  # UI Chat
  - host: chat.invisible.local
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: ui-chat
            port:
              number: 80
  
  # SQLMesh UI
  - host: schema.invisible.local
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: invisible-schema
            port:
              number: 8000
  
  # API Service (for debugging)
  - host: services.invisible.local
    http:
      paths:
      - path: /api
        pathType: Prefix
        backend:
          service:
            name: invisible-api
            port:
              number: 4300
      - path: /etl
        pathType: Prefix
        backend:
          service:
            name: invisible-etl
            port:
              number: 4001
      - path: /operations
        pathType: Prefix
        backend:
          service:
            name: invisible-operations
            port:
              number: 8081